# add_vulnerability_dialog.pyâ€”GUI vuln dropping
from PyQt6.QtWidgets import QDialog, QVBoxLayout, QLabel, QLineEdit, QComboBox, QTextEdit, QPushButton
from core.vulnerability_tracker import add_vulnerability
from core.database import get_targets

class AddVulnerabilityDialog(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("Add Vulnerability")
        self.layout = QVBoxLayout(self)
        
        self.target_label = QLabel("Target URL:")
        self.target_combo = QComboBox()
        self.title_label = QLabel("Title:")
        self.title_input = QLineEdit()
        self.poc_label = QLabel("PoC:")
        self.poc_input = QTextEdit()
        self.severity_label = QLabel("Severity:")
        self.severity_combo = QComboBox()
        self.severity_combo.addItems(["Critical", "High", "Medium", "Low"])
        self.add_btn = QPushButton("Add")
        
        targets = get_targets()
        self.target_combo.addItems([t[1] for t in targets])
        
        self.add_btn.clicked.connect(self.add_vulnerability)
        
        self.layout.addWidget(self.target_label)
        self.layout.addWidget(self.target_combo)
        self.layout.addWidget(self.title_label)
        self.layout.addWidget(self.title_input)
        self.layout.addWidget(self.poc_label)
        self.layout.addWidget(self.poc_input)
        self.layout.addWidget(self.severity_label)
        self.layout.addWidget(self.severity_combo)
        self.layout.addWidget(self.add_btn)

    def add_vulnerability(self):
        target_url = self.target_combo.currentText()
        title = self.title_input.text()
        poc = self.poc_input.toPlainText()
        severity = self.severity_combo.currentText()
        if target_url and title and poc and severity:
            add_vulnerability(target_url, title, poc, severity)
            self.accept()
